I"€&<h1 id="ç½‘ç»œçˆ¬è™«å’Œæ–‡æ¡£å†…å®¹æå–">ç½‘ç»œçˆ¬è™«å’Œæ–‡æ¡£å†…å®¹æå–</h1>

<h2 id="ä¸€å®éªŒå†…å®¹">ä¸€ã€å®éªŒå†…å®¹</h2>

<p>1.è®¾è®¡ä¸€ä¸ªç½‘é¡µçˆ¬è™«ç¨‹åºæˆ–è€…é…ç½®è¿è¡Œå¼€æºçš„ç½‘ç»œçˆ¬è™«è¿›è¡Œç½‘é¡µæŠ“å–ï¼Œå¯ä»¥é€‰æ‹©çˆ¬å–æ–°é—»ç½‘ç«™å’Œç”µå­å•†åŠ¡ç½‘ç«™çš„äº§å“è¯„è®ºã€‚ä¸åŒä¸»é¢˜ç±»åˆ«çš„ç½‘é¡µå­˜æ”¾åœ¨ä¸åŒçš„ç›®å½•ä¸‹</p>

<p>2.æŒæ¡ç½‘é¡µçš„æ ‡ç­¾ç»“æ„ç‰¹ç‚¹ä»¥åŠå†…å®¹æå–åŸç†ï¼Œè®¾è®¡å’Œå®ç°ç½‘é¡µå†…å®¹æå–ç¨‹åºæ–‡æ¡£å†…å®¹æå–åˆ†ä¸º2ä¸ªå°é¢˜ç›®ï¼Œä»»é€‰ä¸€ä¸ªåšã€‚</p>

<p>a.æå–æ–°é—»ç½‘é¡µçš„æ ‡é¢˜ï¼Œæ­£æ–‡ï¼Œå‘è¡¨æ—¶é—´ã€‚</p>

<p>b.æå–æŸäº§å“çš„æ¯æ¡äº§å“è¯„è®ºå†…å®¹ï¼Œå‘è¡¨æ—¶é—´ã€‚</p>

<h2 id="äºŒå®éªŒç¯å¢ƒ">äºŒã€å®éªŒç¯å¢ƒ</h2>

<p>å®éªŒç¯å¢ƒï¼šPython3.6.2ï¼Œ</p>

<p>IDEä¸ºPycharm 2019.1.3</p>

<h2 id="ä¸‰å®éªŒåŠŸèƒ½">ä¸‰ã€å®éªŒåŠŸèƒ½</h2>

<p>requests åº“ä¸»è¦ç”¨æ¥å‘èµ·ç½‘ç»œè¯·æ±‚ï¼Œå¹¶æ¥æ”¶æœåŠ¡å™¨è¿”å›çš„æ•°æ®ï¼›bs4 åº“ä¸»è¦ç”¨æ¥è§£æ html å†…å®¹ï¼Œæ˜¯ä¸€ä¸ªéå¸¸ç®€å•å¥½ç”¨çš„åº“ï¼›os åº“ä¸»è¦ç”¨äºå°†æ•°æ®è¾“å‡ºå­˜å‚¨åˆ°æœ¬åœ°æ–‡ä»¶ä¸­ã€‚</p>

<p>fetchUrl å‡½æ•°ç”¨äºå‘èµ·ç½‘ç»œè¯·æ±‚ï¼Œå®ƒå¯ä»¥è®¿é—®ç›®æ ‡ url ï¼Œè·å–ç›®æ ‡ç½‘é¡µçš„ html å†…å®¹å¹¶è¿”å›ã€‚</p>

<p>è¿™é‡Œå…¶å®æ˜¯åº”è¯¥åšå¼‚å¸¸æ•è·çš„ï¼ˆæˆ‘ä¸ºäº†ç®€å•å°±çœæ‰äº†ï¼ŒåèˆŒå¤´ï¼‰ã€‚å› ä¸ºç½‘ç»œæƒ…å†µæ¯”è¾ƒå¤æ‚ï¼Œå¯èƒ½ä¼šå› ä¸ºå„ç§å„æ ·çš„åŸå› è€Œè®¿é—®å¤±è´¥ï¼ŒÂ r.raise_for_status() è¿™å¥ä»£ç å…¶å®å°±æ˜¯åœ¨åˆ¤æ–­æ˜¯å¦è®¿é—®æˆåŠŸçš„ï¼Œå¦‚æœè®¿é—®å¤±è´¥ï¼Œè¿”å›çš„çŠ¶æ€ç ä¸æ˜¯ 200 ï¼Œæ‰§è¡Œåˆ°è¿™é‡Œæ—¶ä¼šç›´æ¥æŠ›å‡ºç›¸åº”çš„å¼‚å¸¸ã€‚</p>

<p>getPageList å‡½æ•°ï¼Œç”¨äºçˆ¬å–å½“å¤©æŠ¥çº¸çš„å„ç‰ˆé¢çš„é“¾æ¥ï¼Œå°†å…¶ä¿å­˜ä¸ºä¸€ä¸ªæ•°ç»„ï¼Œå¹¶è¿”å›ã€‚</p>

<p>getPageList å‡½æ•°ï¼Œç”¨äºçˆ¬å–å½“å¤©æŠ¥çº¸çš„æŸä¸€ç‰ˆé¢çš„æ‰€æœ‰æ–‡ç« çš„é“¾æ¥ï¼Œå°†å…¶ä¿å­˜ä¸ºä¸€ä¸ªæ•°ç»„ï¼Œå¹¶è¿”å›ã€‚</p>

<p>getContent å‡½æ•°ï¼Œç”¨äºè®¿é—®æ–‡ç« å†…å®¹é¡µï¼Œçˆ¬å–æ–‡ç« çš„æ ‡é¢˜å’Œæ­£æ–‡ï¼Œå¹¶è¿”å›ã€‚</p>

<p>saveFile å‡½æ•°ç”¨äºå°†æ–‡ç« å†…å®¹ä¿å­˜åˆ°æœ¬åœ°çš„æŒ‡å®šæ–‡ä»¶å¤¹ä¸­ã€‚</p>

<p>download_rmrb å‡½æ•°æ˜¯éœ€æ±‚ä¸­è¦æ±‚çš„ä¸»å‡½æ•°ï¼Œå¯ä»¥æ ¹æ® yearï¼Œmonthï¼Œday å‚æ•°ï¼Œä¸‹è½½è¯¥å¤©çš„å…¨éƒ¨æŠ¥çº¸æ–‡ç« å†…å®¹ï¼Œå¹¶æŒ‰ç…§è§„åˆ™ä¿å­˜åœ¨æŒ‡å®šçš„è·¯å¾„ destdir ä¸‹ã€‚</p>

<h2 id="å››å®éªŒç­–ç•¥">å››ã€å®éªŒç­–ç•¥</h2>

<h3 id="1url-ç»„æˆç»“æ„">1.Â URL ç»„æˆç»“æ„</h3>

<p>äººæ°‘æ—¥æŠ¥ç½‘ç«™çš„Â URL çš„ç»“æ„è¿˜æ˜¯æ¯”è¾ƒç›´è§‚çš„ï¼ŒåŸºæœ¬ä¸Šä»€ä¹ˆé‡è¦çš„å‚æ•°ï¼Œæ¯”å¦‚æ—¥æœŸï¼Œç‰ˆé¢å·ï¼Œæ–‡ç« ç¼–å·ä»€ä¹ˆçš„ï¼Œéƒ½åœ¨ URL ä¸­æœ‰æ‰€ä½“ç°ï¼Œæ„æˆçš„è§„åˆ™ä¹Ÿå¾ˆç®€å•ï¼Œåƒè¿™æ ·</p>

<p>ç‰ˆé¢ç›®å½•ï¼šhttp://paper.people.com.cn/rmrb/html/2019-05/06/nbs.D110000renmrb_01.htm</p>

<p>æ–‡ç« å†…å®¹ï¼šhttp://paper.people.com.cn/rmrb/html/2019-05/06/nw.D110000renmrb_20190506_5-01.htm</p>

<p>åœ¨ç‰ˆé¢ç›®å½•çš„é“¾æ¥ä¸­ï¼Œâ€/2019-05/06/â€Â è¡¨ç¤ºæ—¥æœŸï¼Œåé¢çš„ â€œ_01â€ è¡¨ç¤ºè¿™æ˜¯ç¬¬ä¸€ç‰ˆé¢çš„é“¾æ¥ã€‚</p>

<p>åœ¨æ–‡ç« å†…å®¹çš„é“¾æ¥ä¸­ï¼Œâ€/2019-05/06/â€Â è¡¨ç¤ºæ—¥æœŸï¼Œåé¢çš„ â€œ_20190506_5_01â€ è¡¨ç¤ºè¿™æ˜¯Â 2019 å¹´ 5 æœˆ 6 æ—¥æŠ¥çº¸çš„ç¬¬ 1 ç‰ˆç¬¬ 5 ç¯‡æ–‡ç« </p>

<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåœ¨æ—¥æœŸçš„ â€œæœˆâ€ å’Œ â€œæ—¥â€ ä»¥åŠ â€œç‰ˆé¢å·â€ çš„æ•°å­—ï¼Œè‹¥å°äº 10ï¼Œéœ€åœ¨å‰é¢è¡¥Â â€0â€Â ï¼Œè€Œæ–‡ç« çš„ç¯‡å·åˆ™ä¸å¿…ã€‚</p>

<p>äº†è§£åˆ°è¿™ä¸ªä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰ç…§è¿™ä¸ªè§„åˆ™ï¼Œæ„é€ å‡ºä»»æ„ä¸€å¤©æŠ¥çº¸ä¸­äººä¸€ä¸ªç‰ˆé¢çš„é“¾æ¥ï¼Œä»¥åŠä»»æ„ä¸€ç¯‡æ–‡ç« çš„é“¾æ¥ã€‚</p>

<p>å¦‚ï¼š2018 å¹´ 6 æœˆ 5 æ—¥ç¬¬ 4Â ç‰ˆçš„ç›®å½•é“¾æ¥ä¸ºï¼š</p>

<p>http://paper.people.com.cn/rmrb/html/2019-05/06/nbs.D110000renmrb_01.htm</p>

<p>2018 å¹´ 6 æœˆ 1 æ—¥ç¬¬ 2 ç‰ˆç¬¬ 3 ç¯‡æ–‡ç« çš„é“¾æ¥ä¸ºï¼š</p>

<p>http://paper.people.com.cn/rmrb/html/2018-06/01/nw.D110000renmrb_20180601_3-02.htm</p>

<p>ç‚¹å‡»è®¿é—®ï¼Œå‘ç°æœç„¶æ˜¯è¿™æ ·ã€‚è‡³æ­¤ï¼Œç½‘ç«™çš„ URL ç»„æˆç»“æ„åˆ†æå®Œæˆã€‚</p>

<h3 id="2åˆ†æç½‘é¡µ-html-ç»“æ„">2.åˆ†æç½‘é¡µ HTML ç»“æ„</h3>

<p>åœ¨ URL åˆ†æä¸­ï¼Œæˆ‘ä»¬ä¹Ÿå‘ç°äº†ï¼Œç½‘ç«™çš„é¡µé¢è·³è½¬æ˜¯é€šè¿‡ URL çš„æ”¹å˜å®Œæˆçš„ï¼Œä¸æ¶‰åŠåˆ°è¯¸å¦‚ Ajax è¿™æ ·çš„åŠ¨æ€åŠ è½½æ–¹æ³•ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒçš„æ‰€æœ‰æ•°æ®æ˜¯ä¸€å¼€å§‹å°±åŠ è½½å¥½çš„ï¼Œæˆ‘ä»¬åªéœ€è¦å» html ä¸­æå–ç›¸åº”å¾—æ•°æ®å³å¯ã€‚</p>

<p>å¥½äº†ï¼Œè¨€å½’æ­£ä¼ ï¼Œæˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹æˆ‘ä»¬çš„ç›®æ ‡ç½‘ç«™ã€‚æŒ‰ F12 å¬å”¤å‡ºå¼€å‘è€…å·¥å…·ï¼ˆç‚¹å‡»å›¾ä¸­ 1 å¤„çš„å°ç®­å¤´ï¼Œç„¶åç‚¹å‡»ç½‘é¡µä¸­çš„å†…å®¹ï¼Œå¯ä»¥åœ¨ html æºç ä¸­å¿«é€Ÿæ‰¾åˆ°ç›¸åº”çš„ä½ç½®ï¼‰ã€‚</p>

<p>æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œç‰ˆé¢ç›®å½•å­˜æ”¾åœ¨ä¸€ä¸ª id = â€œpageListâ€ çš„ div æ ‡ç­¾ä¸‹ï¼Œclass = â€œright_title1â€Â æˆ– â€œright_title2â€ çš„ div æ ‡ç­¾ä¸­ï¼Œæ¯ä¸€ä¸ª div è¡¨ç¤ºä¸€ä¸ªç‰ˆé¢ï¼Œè€Œç‰ˆé¢çš„é“¾æ¥å°±åœ¨ id = â€œpageLinkâ€ çš„ a æ ‡ç­¾ä¸­ã€‚</p>

<p>ä½¿ç”¨åŒæ ·çš„æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œæ–‡ç« ç›®å½•å­˜æ”¾åœ¨ä¸€ä¸ª id = â€œtitleListâ€ çš„ div æ ‡ç­¾ä¸‹çš„ ul æ ‡ç­¾ä¸­ï¼Œå…¶ä¸­æ¯ä¸€ä¸ª li æ ‡ç­¾è¡¨ç¤ºä¸€ç¯‡æ–‡ç« ï¼Œè€Œæ–‡ç« çš„é“¾æ¥å°±åœ¨ li æ ‡ç­¾ä¸‹çš„ a æ ‡ç­¾ä¸­ã€‚</p>

<p>è¿›å…¥æ–‡ç« å†…å®¹é¡µé¢ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œæ–‡ç« æ ‡é¢˜å­˜æ”¾åœ¨ h1 ï¼Œh2 ï¼Œh3 æ ‡ç­¾ä¸­ï¼ˆæœ‰çš„æ–‡ç« æ ‡é¢˜åªç”¨åˆ°äº† h1 æ ‡ç­¾ï¼Œè€Œæœ‰çš„æ–‡ç« æœ‰å‰¯æ ‡é¢˜å¯èƒ½ä¼šç”¨åˆ° h2 æˆ– h3 æ ‡ç­¾ï¼‰ï¼ŒÂ æ­£æ–‡éƒ¨åˆ†å­˜æ”¾åœ¨ id = â€œozoomâ€ çš„ div æ ‡ç­¾ä¸‹çš„ p æ ‡ç­¾é‡Œã€‚</p>

<p>è‡³æ­¤ï¼Œç›®æ ‡ç½‘ç«™çš„ HTML é¡µé¢åˆ†æå®Œæˆã€‚</p>

<h3 id="3-åˆ¶å®šçˆ¬å–ç­–ç•¥">3. åˆ¶å®šçˆ¬å–ç­–ç•¥</h3>

<p>é€šè¿‡åˆ†æ URL ç»„æˆç»“æ„ä»¥åŠç›®æ ‡ç½‘ç«™çš„Â HTML ç»“æ„ï¼Œæˆ‘ä»¬å·²ç»å®Œæˆäº†çˆ¬è™«çš„å‰æœŸè°ƒç ”å·¥ä½œï¼Œæ¥ä¸‹æ¥éœ€è¦æ ¹æ®ç½‘ç«™çš„ç‰¹ç‚¹åˆ¶å®šç›¸åº”çš„çˆ¬å–ç­–ç•¥ï¼Œç„¶åè¯„ä¼°æ¯ç§æ–¹æ³•çš„ä¼˜åŠ£å’Œéš¾æ˜“ç¨‹åº¦ï¼Œæœ€ç»ˆé€‰æ‹©ä¸€ç§æœ€ä½³æ–¹æ¡ˆï¼Œè¿›è¡Œç¼–ç å®ç°ã€‚</p>

<p>ç¬¬ä¸€éï¼Œå…ˆçˆ¬å–ç‰ˆé¢ç›®å½•ï¼Œå°†æ¯ä¸€ä¸ªç‰ˆé¢çš„é“¾æ¥ä¿å­˜ä¸‹æ¥ï¼›ç¬¬äºŒéï¼Œä¾æ¬¡è®¿é—®æ¯ä¸€ä¸ªç‰ˆé¢çš„é“¾æ¥ï¼Œå°†è¯¥ç‰ˆé¢çš„æ–‡ç« é“¾æ¥ä¿å­˜ä¸‹æ¥ï¼›ç¬¬ä¸‰éï¼Œä¾æ¬¡è®¿é—®æ¯ä¸€ä¸ªæ–‡ç« é“¾æ¥ï¼Œå°†æ–‡ç« çš„æ ‡é¢˜å’Œæ­£æ–‡ä¿å­˜åˆ°æœ¬åœ°ã€‚</p>

<h2 id="äº”å®éªŒä»£ç ">äº”ã€å®éªŒä»£ç </h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import requests
import bs4
import os

#URL
def fetchUrl(url):
       
    headers = {
        'accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8',
        'user-agent': 'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/68.0.3440.106 Safari/537.36',
    }
    
    r = requests.get(url,headers=headers)
    r.raise_for_status()
    r.encoding = r.apparent_encoding
    return r.text
#
def getPageList(year, month, day):
   
    url = 'http://paper.people.com.cn/rmrb/html/' + year + '-' + month + '/' + day + '/nbs.D110000renmrb_01.htm'
    html = fetchUrl(url)
    bsobj = bs4.BeautifulSoup(html,'html.parser')
    pageList = bsobj.find('div', attrs = {'id': 'pageList'}).ul.find_all('div', attrs = {'class': 'right_title-name'})
    linkList = []
    
    for page in pageList:
        link = page.a["href"]
        url = 'http://paper.people.com.cn/rmrb/html/'  + year + '-' + month + '/' + day + '/' + link
        linkList.append(url)
    
    return linkList
#
def getTitleList(year, month, day, pageUrl):
   
    html = fetchUrl(pageUrl)
    bsobj = bs4.BeautifulSoup(html,'html.parser')
    titleList = bsobj.find('div', attrs = {'id': 'titleList'}).ul.find_all('li')
    linkList = []
    
    for title in titleList:
        tempList = title.find_all('a')
        for temp in tempList:
            link = temp["href"]
            if 'nw.D110000renmrb' in link:
                url = 'http://paper.people.com.cn/rmrb/html/'  + year + '-' + month + '/' + day + '/' + link
                linkList.append(url)
    
    return linkList
#
def getContent(html):
   
    bsobj = bs4.BeautifulSoup(html,'html.parser')
    
    title = bsobj.h3.text + '\n' + bsobj.h1.text + '\n' + bsobj.h2.text + '\n'
    #print(title)
    

    pList = bsobj.find('div', attrs = {'id': 'ozoom'}).find_all('p')
    content = ''
    for p in pList:
        content += p.text + '\n'      
    #print(content)
    

    resp = title + content
    return resp
#æœ¬åœ°
def saveFile(content, path, filename):
    
    # å¦‚æœæ²¡æœ‰è¯¥æ–‡ä»¶å¤¹ï¼Œåˆ™è‡ªåŠ¨ç”Ÿæˆ
    if not os.path.exists(path):
        os.makedirs(path)
        
    # ä¿å­˜æ–‡ä»¶
    with open(path + filename, 'w', encoding='utf-8') as f:
        f.write(content)
#ä¸»å‡½æ•°
def download_rmrb(year, month, day, destdir):
   
    pageList = getPageList(year, month, day)
    for page in pageList:
        titleList = getTitleList(year, month, day, page)
        for url in titleList:
            
            # è·å–æ–°é—»æ–‡ç« å†…å®¹
            html = fetchUrl(url)
            content = getContent(html)
            
            # ç”Ÿæˆä¿å­˜çš„æ–‡ä»¶è·¯å¾„åŠæ–‡ä»¶å
            temp = url.split('_')[2].split('.')[0].split('-')
            pageNo = temp[1]
            titleNo = temp[0] if int(temp[0]) &gt;= 10 else '0' + temp[0]
            path = destdir + '/' + year + month + day + '/'
            fileName = year + month + day + '-' + pageNo + '-' + titleNo + '.txt'
            
            # ä¿å­˜æ–‡ä»¶
            saveFile(content, path, fileName)

#å…¥å£            
if __name__ == '__main__':
 
    year = "2019"
    month = "06"
    day = "04"
    destdir = "C:/data"
 
    download_rmrb(year, month, day, destdir)
    print("çˆ¬å–å®Œæˆï¼š" + year + month + day)
</code></pre></div></div>

<h2 id="å…­å®éªŒæˆªå›¾">å…­ã€å®éªŒæˆªå›¾</h2>

<p><img src="https://gitee.com/btbsja/BlogImg/raw/master/blog/2020/03/20200309090457.png" alt="" />{width=â€6.0625inâ€ height=â€4.749305555555556inâ€}</p>

<p><img src="https://gitee.com/btbsja/BlogImg/raw/master/blog/2020/03/20200309090458.png" alt="" />{width=â€5.281944444444444inâ€ height=â€5.594444444444444inâ€}<img src="https://gitee.com/btbsja/BlogImg/raw/master/blog/2020/03/20200309090459.png" alt="" />{width=â€5.358333333333333inâ€ height=â€4.197916666666667inâ€}</p>
:ET