---
layout:     post   				    # 使用的布局（不需要改）
title:     XSS及CSRF攻击防御			    # 标题 
subtitle:                 #副标题
date:       2020-03-22			# 时间
author:     Btbsja					# 作者
header-img: img/bg-2020-03-16.jpg 	    #这篇文章标题背景图片
catalog: true 						# 是否归档
tags:								#标签

    - 计算机网络
---

# XSS及CSRF攻击防御

## 一、XSS

### 概念

- 跨站脚本攻击(Cross Site Scripting)
- 这类漏洞能够使得攻击者嵌入恶意脚本代码到正常用户会访问到的页面中，当正常用户访问该页面时，则可导致嵌入的恶意脚本代码的执行，从而达到恶意攻击用户的目的。

### 原理

当动态页面中插入的内容含有这些特殊字符（如<）时，用户浏览器会将其误认为是插入了HTML标签，当这些HTML标签引入了一段JavaScript脚本时，这些脚本程序就将会在用户浏览器中执行。所以，当这些特殊字符不能被动态页面检查或检查出现失误时，就将会产生XSS漏洞。

### 类型

- 存储型：跨站代码存储在服务器（数据库）
- 反射型：用户访问服务器-跨站链接-返回跨站代码
- DOM：受害者端的网页脚本在修改本地页面DOM环境时未进行合理的处置，而使得攻击脚本被执行

### 攻击方式

- 盗用[cookie](https://baike.baidu.com/item/cookie/1119)，获取敏感信息。

- 利用植入Flash，通过crossdomain权限设置进一步获取更高权限；或者利用[Java](https://baike.baidu.com/item/Java/85979)等得到类似的操作。

- 利用[iframe](https://baike.baidu.com/item/iframe/4446518)、frame、[XMLHttpRequest](https://baike.baidu.com/item/XMLHttpRequest/6788735)或上述Flash等方式，以（被攻击）用户的身份执行一些管理动作，或执行一些一般的如发微博、加好友、发私信等操作。

- 利用可被攻击的域受到其他域信任的特点，以受信任来源的身份请求一些平时不允许的操作，如进行不当的投票活动。

- 在访问量极大的一些页面上的XSS可以攻击一些小型网站，实现DDoS攻击的效果。

### 防御方法

1. 基于特征的防御
   - 针对“javascript”这个关键字进行检索
2. 基于代码修改的防御
   - 用户向服务器上提交的信息要对URL和附带的的HTTP头、POST数据等进行查询，对不是规定格式、长度的内容进行过滤
   - 实现Session标记（session tokens）、CAPTCHA系统或者HTTP引用头检查，以防功能被第三方网站所执行
   - 确认接收的的内容被妥善的规范化，仅包含最小的、安全的Tag（没有javascript），去掉任何对远程内容的引用（尤其是样式表和javascript），使用HTTP only的cookie

3. 客户端分层防御策略
   - 对每一个网页分配独立线程且分析资源消耗的“网页线程分析模块”
   - 包含分层防御策略四个规则的用户输入分析模块
   - 保存互联网上有关XSS恶意网站信息的XSS信息数据库。

## 二、CSRF

### 概念

- 跨站请求伪造（Cross-site request forgery）
- 挟制用户在当前已登录的Web应用程序上执行非本意的操作。

### 原理

攻击者通过一些技术手段欺骗用户的浏览器去访问一个自己曾经认证过的网站并运行一些操作（如发邮件，发消息，甚至财产操作如转账和购买商品）。由于浏览器曾经认证过，所以被访问的网站会认为是真正的用户操作而去运行。这利用了web中用户身份验证的一个漏洞：简单的身份验证只能保证请求发自某个用户的浏览器，却不能保证请求本身是用户自愿发出的。

![](https://gitee.com/btbsja/BlogImg/raw/master/blog/2020/03/20200322212034.png)

### 防御措施

1. **检查Referer字段**
   - HTTP头中有一个Referer字段，这个字段用以标明请求来源于哪个地址。在处理敏感数据请求时，通常来说，Referer字段应和请求的地址位于同一域名下。
   - 只接受本站的请求，服务器才做响应；如果不是，就拦截。
2. **添加校验token**
   - 服务器发送给客户端一个token；
   - 客户端提交的表单中带着这个token。
   - 如果这个 token 不合法，那么服务器拒绝这个请求。

## 区别

- CSRF：需要用户先登录网站A，获取 cookie；
- XSS：不需要登录。
- CSRF：是利用网站A本身的漏洞，去请求网站A的api；
- XSS：是向网站 A 注入 JS代码，然后执行 JS 里的代码，篡改网站A的内容。